#!/usr/local/bin/zsh

local LOGDIR=$HOME/Documents/term_logs
local LOGFILE=$(hostname)_$(date +%Y-%m-%d_%H%M%S.log)
local FILECOUNT=0
local MAXFILECOUNT=500
# 本スクリプト起動時に自動で$MAXFILECOUNTのファイル数以上ログファイルあれば消す
for file in `\find "$LOGDIR" -maxdepth 1 -type f -name "*.log" | sort --reverse`; do
  FILECOUNT=`expr $FILECOUNT + 1`
  if [ $FILECOUNT -ge $MAXFILECOUNT ]; then
    rm -f $file
  fi
done
[ ! -d $LOGDIR ] && mkdir -p $LOGDIR
tmux  set-option default-terminal "screen" \; \
pipe-pane        "cat - | ansifilter >> $LOGDIR/$LOGFILE" \; \
display-message  "💾Started logging to $LOGDIR/$LOGFILE"
env LANG=C ssh -o StrictHostKeyChecking=no $@
tmux pipe-pane\; display-message  "🔔End logging to $LOGDIR/$LOGFILE"
